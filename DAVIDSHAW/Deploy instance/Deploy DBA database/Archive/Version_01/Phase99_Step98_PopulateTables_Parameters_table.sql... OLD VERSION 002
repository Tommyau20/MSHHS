USE [DBA]
GO

INSERT INTO [dbo].[Parameters]
           ([Parameter]
  	   ,[Value])
     VALUES
           ('Deployment date'
	   ,(SELECT CONVERT(VARCHAR,GETDATE(), 20)))
GO

INSERT INTO [dbo].[Parameters]
           ([Parameter]
  	   ,[Value])
     VALUES
           ('Environment'
	   ,'???????')
GO

INSERT INTO [dbo].[Parameters]
           ([Parameter]
  	   ,[Value])
     VALUES
           ('SharedInstance'
	   ,'???????')
GO


-- ********************************************************************************
-- The below inserts do not need configuring. They will be populated as required.
-- ********************************************************************************
INSERT INTO [dbo].[Parameters]
           ([Parameter]
  	   ,[Value])
     VALUES
           ('DBA Central last connection'
	   ,NULL)
GO

INSERT INTO [dbo].[Parameters]
	  ([Parameter]
  	  ,[Value])
     VALUES
	  ('CPU count at deployment'
	  ,(SELECT cpu_count FROM sys.dm_os_sys_info))
GO

INSERT INTO [dbo].[Parameters]
	  ([Parameter]
  	  ,[Value])
     VALUES
	  ('Hyperthread ratio at deployment'
	  ,(SELECT hyperthread_ratio FROM sys.dm_os_sys_info))
GO

INSERT INTO [dbo].[Parameters]
           ([Parameter]
  	       ,[Value])
     VALUES
        ('MAXDOP at deployment'
	    ,(SELECT cpu_count / hyperthread_ratio FROM sys.dm_os_sys_info))
GO

INSERT INTO [dbo].[Parameters]
           ([Parameter]
  	       ,[Value])
     VALUES
        ('Cost threshold for parallelism at deployment'
	    ,(SELECT CONVERT(VARCHAR(MAX), [value_in_use]) FROM sys.configurations WHERE [NAME] = 'cost threshold for parallelism'))
GO

-- ******************************************************************************
DECLARE @total_os_RAM_at_deployment int
DECLARE @min_SQL_RAM_at_deployment int
DECLARE @max_SQL_RAM_at_deployment int
SELECT @total_os_RAM_at_deployment = [Value] from [DBA].[dbo].[Parameters] WHERE [Parameter] = 'Total physical memory (MB) at deployment'
SELECT @min_SQL_RAM_at_deployment = [Value] from [DBA].[dbo].[Parameters] WHERE [Parameter] = 'Min. server memory (MB) at deployment'
SELECT @max_SQL_RAM_at_deployment = [Value] from [DBA].[dbo].[Parameters] WHERE [Parameter] = 'Max. server memory (MB) at deployment'	

If (@total_os_RAM_at_deployment IS NULL)
	BEGIN
	INSERT INTO [dbo].[Parameters]
			   ([Parameter]
  			   ,[Value])
		 VALUES
			('Total physical memory (MB) at deployment'
			,(SELECT [total_physical_memory_kb]/(1024^2) from sys.dm_os_sys_memory))
	END
If (@min_SQL_RAM_at_deployment IS NULL)
	BEGIN
	INSERT INTO [dbo].[Parameters]
			   ([Parameter]
  			   ,[Value])
		 VALUES
			('Min. server memory (MB) at deployment'
			,(SELECT ConVERT(VARCHAR(MAX), [value_in_use]) FROM sys.configurations WHERE [NAME] = 'min server memory (MB)'))
	END
If (@max_SQL_RAM_at_deployment IS NULL)
	BEGIN
	INSERT INTO [dbo].[Parameters]
			   ([Parameter]
  			   ,[Value])
		 VALUES
			('Max. server memory (MB) at deployment'
			,(SELECT ConVERT(VARCHAR(MAX), [value_in_use]) FROM sys.configurations WHERE [NAME] = 'max server memory (MB)'))
	END

-- ******************************************************************************
Select * from [DBA].[dbo].[Parameters]
